# 企业级统一认证授权系统 (IAM) 需求文档

## 1. 引言

### 1.1 背景
随着企业数字化转型的深入，应用系统数量激增。为了统一管理用户信息、提高安全性并优化用户体验，需要构建一套安全、高效、可扩展的企业级登录注册系统。

### 1.2 目标
构建满足等级保护三级认证要求，支持千万级用户规模，具备高可用、高并发能力的统一认证中心。

## 2. 功能需求

### 2.1 注册功能 (Registration)
- **多渠道注册**:
    - 手机号 + 短信验证码注册。
    - 邮箱 + 激活链接/验证码注册。
    - 第三方账号授权注册 (微信、钉钉、GitHub) 并绑定手机号。
- **流程控制**:
    - **验证码防刷**: 集成图形滑块验证码 (如阿里云/腾讯云验证码) 前置校验，防止短信接口被恶意盗刷。
    - **密码强度策略**: 强制要求大写字母、小写字母、数字、特殊符号组合，长度 8-20 位。
    - **实名认证 (可选)**: 针对特定行业，注册后需上传身份证进行 OCR 识别及人脸比对。
- **协议签署**: 强制勾选《用户服务协议》和《隐私政策》。

### 2.2 登录功能 (Authentication)
- **多方式登录**:
    - 账号/手机号/邮箱 + 密码。
    - 手机号 + 短信验证码 (免密登录)。
    - 第三方快捷登录 (微信、支付宝、钉钉)。
    - **SSO 单点登录**: 支持 OAuth 2.0 / OIDC (OpenID Connect) / SAML 2.0 协议，实现"一处登录，全网通行"。
    - **扫码登录**: App 扫码登录 Web 端。
- **安全增强**:
    - **MFA 多因素认证**: 在异地登录、更换设备或连续失败时，强制二次验证 (短信/邮件/TOTP Google Authenticator)。
    - **登录封禁**: 连续输错密码 5 次，锁定账号 15 分钟或需人工解锁。

### 2.3 密码与账号管理
- **找回密码**: 
    - 验证身份 (手机/邮箱验证码) -> 重置密码。
    - 人工申诉通 (当手机/邮箱均不可用时)。
- **修改密码**: 需验证旧密码。且新密码不能与最近 3 次密码相同。
- **账号注销**: 提供自助注销入口，具备注销冷静期 (如 7 天)。

### 2.4 权限管理 (Authorizaton - RBAC)
- **用户-角色-权限**: 支持基于 RBAC (Role-Based Access Control) 的权限模型。
- **动态菜单**: 根据用户权限动态返回前端菜单树。
- **接口鉴权**: 网关层/中间件层基于 Token 校验接口访问权限。

## 3. 非功能需求 (NFR)

### 3.1 安全性 (Security)
- **传输加密**: 全站 HTTPS (TLS 1.2+)。
- **敏感数据加密**: 密码采用 `PBKDF2` 或 `BCrypt` 加盐哈希存储；手机号、身份证号 AES-256 对称加密存储。
- **防攻击**:
    - 防 SQL 注入、XSS、CSRF 攻击。
    - 关键接口 (发送验证码、登录) 限流 (Rate Limiting)，IP 黑名单机制。
- **会话管理**:
    - 使用 JWT (Json Web Token) 或 Redis Session。
    - 支持踢人下线、单端已登录互斥 (可选)。
    - Token 过期时间设置 (Access Token 短效，Refresh Token 长效)。

### 3.2 性能与可靠性
- **响应时间**: 登录/注册接口 P99 < 500ms。
- **并发能力**: 支持 TPS 1000+ (需根据实际服务器资源调整)。
- **高可用**: 服务无状态设计，支持水平扩展 (Scale-out)。

### 3.3 审计日志 (Audit Logging)
- 记录所有登录、注册、修改密码、鉴权失败的操作日志。
- 日志内容包括: 用户ID、IP地址、设备指纹 (User-Agent)、地理位置、操作时间、操作结果。

## 4. 数据模型设计 (核心字段)

### 4.1 用户主表 (sys_user)
- `id`: 主键 (Snowflake ID)
- `username`: 用户名
- `password`: 加密后的密码
- `mobile`: 手机号 (加密)
- `email`: 邮箱
- `status`: 状态 (0:正常, 1:锁定, 2:注销)
- `create_time`: 创建时间

### 4.2 认证日志表 (sys_login_log)
- `user_id`: 关联用户
- `ip_address`: IP地址
- `login_location`: 归属地
- `browser`: 浏览器/客户端
- `os`: 操作系统
- `status`: 登录状态
- `msg`: 提示消息

## 5. UI/UX 交互建议
- **加载状态**: 点击登录后按钮显示 Loading，防止重复提交。
- **即时反馈**: 输入框失去焦点时即时校验格式 (如手机号格式)。
- **移动端适配**: 响应式布局，支持 H5 及小程序。
